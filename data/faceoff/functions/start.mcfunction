# identify spectators
execute if score starttimer global matches 1.. run team join a @a[gamemode=survival]
execute if score starttimer global matches 1.. run team join h @a[gamemode=!survival]

# if teams are enabled, sort players into teams
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]
execute if score starttimer global matches 1.. run team join r @r[team=a]
execute if score starttimer global matches 1.. run team join g @r[team=a]
execute if score starttimer global matches 1.. run team join b @r[team=a]

# set individual player scores
execute if score starttimer global matches 1.. run scoreboard players set @a[gamemode=survival] deathtime 1
execute if score starttimer global matches 1.. run scoreboard players set @a[gamemode=survival] killtime 1
execute if score starttimer global matches 1.. run scoreboard players set @a gameclock 0
execute if score starttimer global matches 1.. run scoreboard players set @a mobkills 0
execute if score starttimer global matches 1.. if score tournament global matches 0 run scoreboard players set @a bars 0
execute if score starttimer global matches 1.. if score tournament global matches 1 run scoreboard players set @a bars 3
execute if score starttimer global matches 1.. run scoreboard players set @a infected 0
execute if score starttimer global matches 1.. run scoreboard players set @a hauntprompt 0
execute if score starttimer global matches 1.. if score tournament global matches 0 run scoreboard players set @a damagealert 2
execute if score starttimer global matches 1.. if score tournament global matches 1 run scoreboard players set @a damagealert 1

# reprocess advantage
execute if score starttimer global matches 1.. run scoreboard players set @r[scores={advantage=1}] adv 1
execute if score starttimer global matches 1.. run scoreboard players set @a[gamemode=survival] advantage 0

# set environment
execute if score starttimer global matches 1.. run scoreboard players set wbshrink global 0
execute if score starttimer global matches 1.. run scoreboard players set ended global 0
execute if score starttimer global matches 1.. run scoreboard objectives setdisplay sidebar.team.dark_purple hauntpoints
execute if score starttimer global matches 1.. run gamerule doDaylightCycle true
execute if score starttimer global matches 1.. run gamerule drowningDamage true
execute if score starttimer global matches 1.. run effect clear @a
execute if score starttimer global matches 1.. run clear @a
execute if score starttimer global matches 1.. run weather clear
execute if score starttimer global matches 1.. run time set 50t
execute if score starttimer global matches 1.. run gamerule doMobSpawning true
execute if score starttimer global matches 1.. run gamerule doMobLoot true
execute if score starttimer global matches 1.. run gamerule doTileDrops true
execute if score starttimer global matches 1.. run title @a times 20 150 20
execute if score starttimer global matches 1.. run bossbar set 1 players @a
execute if score starttimer global matches 1.. run bossbar set 3 players

# beginning of game effects
execute if score starttimer global matches 1.. run effect give @a saturation 5 9 true
execute if score starttimer global matches 1.. run effect give @a resistance 30 4 true
execute if score starttimer global matches 1.. run effect give @a invisibility 60 1 true
execute if score starttimer global matches 1.. run effect give @a regeneration 180 2 true
execute if score starttimer global matches 1.. if score tournament global matches 1 run effect give @a speed 20 1 true

# expand world border
execute if score starttimer global matches 1.. if score tournament global matches 0 run worldborder set 750 200
execute if score starttimer global matches 1.. if score tournament global matches 1 run worldborder set 1200 200

# advancement and help reminder
execute if score starttimer global matches 1.. run advancement grant @a only minecraft:adventure/root
execute if score starttimer global matches 1.. run tellraw @a [{"text":"Tip: You can run \"/trigger menu\" or ","italic":true,"color":"gray"},{"text":"[click here]","color":"gray","italic":true,"clickEvent":{"action":"run_command","value":"/trigger menu"}},{"text":" to show the Player Menu at any time during the game.","italic":true,"color":"gray"}]